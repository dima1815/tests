<?xml version="1.0" encoding="UTF-8"?>
<atlassian-plugin key="com.mycomp.jira.execspec.execspec-jira-plugin" name="Executable Specification"
                  plugins-version="2">
    <plugin-info>
        <description>Executable Specification Jira Plugin</description>
        <version>0.1</version>
        <vendor name="${project.organization.name}" url="${project.organization.url}"/>
    </plugin-info>

    <!-- ==================================================================================================== -->
    <!--custom javascript and css-->
    <!-- ==================================================================================================== -->
    <web-resource name="Story Service Resources" key="story-service-resources">
        <dependency>com.atlassian.auiplugin:ajs</dependency>
        <dependency>com.atlassian.auiplugin:dialog2</dependency>
        <resource type="download" name="story-service.js" location="js/custom/story-service.js">
            <param name="content-type" value="text/javascript"/>
        </resource>
        <resource type="download" name="custom-style.css" location="css/custom/custom-style.css">
            <param name="content-type" value="text/css"/>
        </resource>
        <context>jira.view.issue</context>
        <!--<context>jira.general</context>-->
    </web-resource>

    <web-resource key="jira-example-plugin-resources" name="jira-example-plugin Web Resources">
        <dependency>com.atlassian.auiplugin:ajs</dependency>
        <resource type="download" name="jira-example-plugin.js" location="/js/custom/jira-example-plugin.js"/>
        <transformation extension="soy">
            <transformer key="soyTransformer"/>
        </transformation>
        <!-- soy -->
        <resource type="download" name="PluginView.soy.js" location="templates/soy/view-issue-page/PluginView.soy"/>
        <resource type="download" name="AddNewStoryForm.soy.js"
                  location="templates/soy/view-issue-page/AddNewStoryForm.soy"/>
        <!-- javascript -->
        <resource type="download" name="PluginController.js" location="js/custom/PluginController.js"/>
        <resource type="download" name="PluginModel.js" location="js/custom/PluginModel.js"/>
        <resource type="download" name="PluginView.js" location="js/custom/PluginView.js"/>

        <context>jira.view.issue</context>
    </web-resource>

    <!-- ==================================================================================================== -->
    <!-- REST api-->
    <!-- ==================================================================================================== -->
    <rest name="Story Resource" i18n-name-key="story-resource.name" key="stories-res" path="/story-res" version="1.0">
        <description key="story-resource.description">The story rest resource plugin</description>
    </rest>

    <!-- ==================================================================================================== -->
    <!-- View Issue page related stuff -->
    <!-- ==================================================================================================== -->

    <resource type="i18n" name="story-dialog" location="i18n/story-dialog"/>
    <resource type="i18n" name="exec-spec-panel" location="i18n/exec-spec-panel"/>

    <!-- tool bar button to Add New Story -->
    <web-item name="Schedule Web Item" i18n-name-key="schedule-web-item.name" key="schedule-web-item"
              section="operations-top-level" weight="3">
        <description key="schedule-web-item.description">The Schedule Web Item Plugin</description>
        <conditions type="and">
            <condition class="com.atlassian.jira.plugin.webfragment.conditions.IsIssueEditableCondition"/>
            <condition class="com.atlassian.jira.plugin.webfragment.conditions.HasIssuePermissionCondition">
                <param name="permission" value="edit"/>
            </condition>
            <condition class="com.atlassian.jira.plugin.webfragment.conditions.IsFieldHiddenCondition" invert="true">
                <param name="field" value="fixVersions"/>
            </condition>
        </conditions>
        <label key="addNewStoryButton.label"/>
        <link linkId="add-new-story-web-item-link">/secure/AddWebworkModuleAction!default.jspa?id=${issueId}</link>
        <styleClass>add-new-story-button</styleClass>
    </web-item>

    <!-- stories panel -->
    <web-panel name="Executable Stories" i18n-name-key="acceptancetests-panel.name"
               key="acceptancetests-panel" location="atl.jira.view.issue.left.context" weight="211">
        <description key="acceptancetests-panel.description">Excecutable Stories</description>
        <resource name="view" type="velocity"
                  location="templates/velocity/view-issue-page/executable-specs-template.vm"/>
        <label key="acceptancetests-panel.title"/>
        <context-provider class="com.mycomp.execspec.jiraplugin.ui.contextproviders.ViewIssueStoriesContextProvider"/>
    </web-panel>


    <!-- ==================================================================================================== -->
    <!-- Active Objects stuff -->
    <!-- ==================================================================================================== -->
    <component-import key="ao" name="Active Objects service"
                      interface="com.atlassian.activeobjects.external.ActiveObjects">
        <description>Component to access Active Objects functionality from the plugin</description>
    </component-import>
    <component key="tx-processor" name="Transactional Annotation Processor"
               class="com.atlassian.activeobjects.external.TransactionalAnnotationProcessor">
        <decription>Processes @Transactional annotations.</decription>
    </component>
    <ao key="ao-module">
        <description>The module configuring the Active Objects service used by this plugin</description>
        <entity>com.mycomp.execspec.jiraplugin.ao.StoryAO</entity>
    </ao>

    <!-- ==================================================================================================== -->
    <!-- Custom components -->
    <!-- ==================================================================================================== -->
    <component key="story-dao" name="Story DAO" class="com.mycomp.execspec.jiraplugin.ao.StoryDaoImpl"/>
    <component key="story-service" name="Story Service"
               class="com.mycomp.execspec.jiraplugin.service.StoryServiceImpl"/>

</atlassian-plugin>
