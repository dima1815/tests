<?xml version="1.0" encoding="UTF-8"?>
<atlassian-plugin key="com.mycomp.jira.execspec.execspec-jira-plugin" name="Executable Specification"
                  plugins-version="2">
    <plugin-info>
        <description>Executable Specification Jira Plugin</description>
        <version>0.1</version>
        <vendor name="${project.organization.name}" url="${project.organization.url}"/>
    </plugin-info>

    <!-- ==================================================================================================== -->
    <!--custom javascript and css-->
    <!-- ==================================================================================================== -->
    <web-resource name="View Issue Page Resources" key="execspec-view-issue-page-resources">
        <dependency>com.atlassian.auiplugin:ajs</dependency>
        <transformation extension="soy">
            <transformer key="soyTransformer"/>
        </transformation>
        <!--common-->
        <resource type="download" name="StoryModel.js" location="/js/custom/StoryModel.js"/>
        <resource type="download" name="ScenarioModel.js" location="/js/custom/ScenarioModel.js"/>
        <resource type="download" name="StoryService.js" location="/js/custom/StoryService.js"/>
        <resource type="download" name="PageUtils.js" location="/js/custom/PageUtils.js"/>
        <!--edit story-->
        <resource type="download" name="EditStoryController.js" location="/js/custom/editstory/EditStoryController.js"/>
        <resource type="download" name="EditStoryView.js" location="/js/custom/editstory/EditStoryView.js"/>
        <resource type="download" name="EditStoryTemplates.soy.js"
                  location="js/custom/editstory/EditStoryTemplates.soy"/>
        <!--delete story-->
        <resource type="download" name="DeleteStoryController.js"
                  location="/js/custom/deletestory/DeleteStoryController.js"/>
        <!--issue stories-->
        <resource type="download" name="ShowStoryTemplates.soy.js"
                  location="/js/custom/showstory/ShowStoryTemplates.soy"/>
        <resource type="download" name="ShowStoryController.js"
                  location="/js/custom/showstory/ShowStoryController.js"/>
        <resource type="download" name="ShowStoryModel.js" location="/js/custom/showstory/ShowStoryModel.js"/>
        <resource type="download" name="ShowStoryView.js" location="/js/custom/showstory/ShowStoryView.js"/>
        <!-- CSS -->
        <resource type="download" name="custom-style.css" location="css/custom-style.css">
            <param name="content-type" value="text/css"/>
        </resource>
        <context>jira.view.issue</context>
    </web-resource>

    <!-- ==================================================================================================== -->
    <!-- REST api-->
    <!-- ==================================================================================================== -->
    <rest name="Story Resource" i18n-name-key="story-resource.name" key="stories-res" path="/story-res" version="1.0">
        <description key="story-resource.description">The story rest resource plugin</description>
    </rest>

    <!-- ==================================================================================================== -->
    <!-- View Issue page -->
    <!-- ==================================================================================================== -->
    <resource type="i18n" name="story-dialog" location="i18n/story-dialog"/>
    <resource type="i18n" name="exec-spec-panel" location="i18n/exec-spec-panel"/>

    <!-- ==================================================================================================== -->
    <!-- tool bar links -->
    <!-- ==================================================================================================== -->
    <web-section key="jbehave-story-section" name="JBehave Story" location="opsbar-operations" weight="20">
        <label key="jbehave.story.section.label"/>
    </web-section>
    <web-item name="Create Story Item" i18n-name-key="create-story-web-item.name" key="create-story-web-item"
              section="jbehave-story-section" weight="10">
        <description key="create-story-web-item.description">The Create Story Web Item</description>
        <conditions type="and">
            <condition class="com.atlassian.jira.plugin.webfragment.conditions.IsIssueEditableCondition"/>
            <condition class="com.atlassian.jira.plugin.webfragment.conditions.HasIssuePermissionCondition">
                <param name="permission" value="edit"/>
            </condition>
            <condition class="com.atlassian.jira.plugin.webfragment.conditions.IsFieldHiddenCondition" invert="true">
                <param name="field" value="fixVersions"/>
            </condition>
        </conditions>
        <label key="addNewStoryButton.label"/>
        <link linkId="add-new-story-web-item-link">/#</link>
        <styleClass>add-new-story-button</styleClass>
    </web-item>
    <web-item name="Edit Story Item" i18n-name-key="edit-story-web-item.name" key="edit-story-web-item"
              section="jbehave-story-section" weight="20">
        <description key="edit-story-web-item.description">The Edit Story Web Item</description>
        <label key="editStoryButton.label"/>
        <link linkId="edit-story-web-item-link">/#</link>
        <styleClass>edit-story-button</styleClass>
    </web-item>
    <web-item name="Delete Story Item" i18n-name-key="delete-story-web-item.name" key="delete-story-web-item"
              section="jbehave-story-section" weight="30">
        <description key="delete-story-web-item.description">The Delete Story Web Item</description>
        <label key="deleteStoryButton.label"/>
        <link linkId="delete-story-web-item-link">/#</link>
        <styleClass>delete-story-button</styleClass>
    </web-item>

    <!-- ==================================================================================================== -->
    <!-- stories panel -->
    <!-- ==================================================================================================== -->
    <web-panel name="Executable Stories" i18n-name-key="acceptancetests-panel.name"
               key="acceptancetests-panel" location="atl.jira.view.issue.left.context" weight="211">
        <description key="acceptancetests-panel.description">Excecutable Stories</description>
        <resource name="view" type="velocity"
                  location="templates/velocity/view-issue-page/executable-specs-template.vm"/>
        <label key="acceptancetests-panel.title"/>
        <context-provider class="com.mycomp.execspec.jiraplugin.ui.contextproviders.ViewIssueStoriesContextProvider"/>
    </web-panel>


    <!-- ==================================================================================================== -->
    <!-- Active Objects stuff -->
    <!-- ==================================================================================================== -->
    <component-import key="ao" name="Active Objects service"
                      interface="com.atlassian.activeobjects.external.ActiveObjects">
        <description>Component to access Active Objects functionality from the plugin</description>
    </component-import>
    <component key="tx-processor" name="Transactional Annotation Processor"
               class="com.atlassian.activeobjects.external.TransactionalAnnotationProcessor">
        <decription>Processes @Transactional annotations.</decription>
    </component>
    <ao key="ao-module">
        <description>The module configuring the Active Objects service used by this plugin</description>
        <entity>com.mycomp.execspec.jiraplugin.ao.Story</entity>
        <entity>com.mycomp.execspec.jiraplugin.ao.Scenario</entity>
    </ao>

    <!-- ==================================================================================================== -->
    <!-- Custom components -->
    <!-- ==================================================================================================== -->
    <component key="story-dao" name="Story DAO" class="com.mycomp.execspec.jiraplugin.ao.StoryDao"/>
    <component key="scenario-dao" name="Scenario DAO" class="com.mycomp.execspec.jiraplugin.ao.ScenarioDao"/>
    <component key="story-service" name="Story Service"
               class="com.mycomp.execspec.jiraplugin.service.StoryServiceImpl"/>

</atlassian-plugin>
