<?xml version="1.0" encoding="UTF-8"?>
<atlassian-plugin key="com.mycomp.jira.execspec.execspec-jira-plugin" name="Executable Specification"
                  plugins-version="2">
    <plugin-info>
        <description>Executable Specification Jira Plugin</description>
        <version>0.1</version>
        <vendor name="${project.organization.name}" url="${project.organization.url}"/>
    </plugin-info>

    <!-- ==================================================================================================== -->
    <!--custom javascript and css-->
    <!-- ==================================================================================================== -->
    <web-resource name="Story Service Resources" key="story-service-resources" >
        <dependency>com.atlassian.auiplugin:ajs</dependency>
        <resource type="download" name="story-service.js" location="js/custom/story-service.js">
            <param name="content-type" value="text/javascript"/>
        </resource>
        <resource type="download" name="custom-style.css" location="css/custom/custom-style.css">
            <param name="content-type" value="text/css"/>
        </resource>
        <context>jira.view.issue</context>
        <!--<context>alt.general</context>-->
        <!--<context>jira.general</context>-->
    </web-resource>

    <!-- ==================================================================================================== -->
    <!-- REST api-->
    <!-- ==================================================================================================== -->
    <rest name="Story Resource" i18n-name-key="story-resource.name" key="stories-res" path="/story-res" version="1.0">
        <description key="story-resource.description">The story rest resource plugin</description>
    </rest>

    <!-- ==================================================================================================== -->
    <!-- View Issue page related stuff -->
    <!-- ==================================================================================================== -->

    <resource type="i18n" name="story-dialog" location="i18n/story-dialog"/>
    <resource type="i18n" name="exec-spec-panel" location="i18n/exec-spec-panel"/>

    <web-panel name="Executable Stories" i18n-name-key="acceptancetests-panel.name"
               key="acceptancetests-panel" location="atl.jira.view.issue.left.context" weight="211">
        <description key="acceptancetests-panel.description">Excecutable Stories</description>
        <resource name="view" type="velocity"
                  location="templates/velocity/view-issue-page/executable-specs-template.vm"/>
        <label key="acceptancetests-panel.title"/>
        <context-provider class="com.mycomp.execspec.jiraplugin.ui.contextproviders.ViewIssueStoriesContextProvider"/>
    </web-panel>

    <webwork1 key="scheduler-webwork-module" name="Scheduler Webwork Module" i18n-name-key="scheduler-webwork-module.name">
        <description key="scheduler-webwork-module.description">The Scheduler Webwork Module Plugin</description>
        <actions>
            <action name="com.mycomp.execspec.jiraplugin.ui.actions.SchedulerWebworkModuleAction" alias="SchedulerWebworkModuleAction">
                <view name="input">/templates/velocity/view-issue-page/add_new_story.vm</view>
                <view name="error">/templates/velocity/view-issue-page/add_new_story.vm</view>
            </action>
        </actions>
    </webwork1>

    <web-item name="Schedule Web Item" i18n-name-key="schedule-web-item.name" key="schedule-web-item" section="operations-top-level" weight="3">
        <description key="schedule-web-item.description">The Schedule Web Item Plugin</description>
        <conditions type="and">
            <condition class="com.atlassian.jira.plugin.webfragment.conditions.IsIssueEditableCondition"/>
            <condition class="com.atlassian.jira.plugin.webfragment.conditions.HasIssuePermissionCondition">
                <param name="permission" value="edit"/>
            </condition>
            <condition class="com.atlassian.jira.plugin.webfragment.conditions.IsFieldHiddenCondition" invert="true">
                <param name="field" value="fixVersions"/>
            </condition>
        </conditions>
        <label key="addNewStoryButton.label"/>
        <link linkId="schedule-web-item-link">/secure/SchedulerWebworkModuleAction!default.jspa?id=${issueId}</link>
        <styleClass>issueaction-schedule-issue</styleClass>
    </web-item>

    <web-resource name="Scheduler Web Resource" i18n-name-key="scheduler-web-resource.name" key="scheduler-web-resource">
        <description key="scheduler-web-resource.description">The Scheduler Web Resource Plugin</description>
        <context>jira.general</context>
        <transformation extension="js">
            <transformer key="jsI18n"/>
        </transformation>
        <resource type="download" name="scheduler.js" location="js/custom/add_new_story.js">
            <property key="content-type" value="text/javascript"/>
        </resource>
    </web-resource>

    <!-- ==================================================================================================== -->
    <!-- Active Objects stuff -->
    <!-- ==================================================================================================== -->
    <component-import key="ao" name="Active Objects service"
                      interface="com.atlassian.activeobjects.external.ActiveObjects">
        <description>Component to access Active Objects functionality from the plugin</description>
    </component-import>
    <component key="tx-processor" name="Transactional Annotation Processor"
               class="com.atlassian.activeobjects.external.TransactionalAnnotationProcessor">
        <decription>Processes @Transactional annotations.</decription>
    </component>
    <ao key="ao-module">
        <description>The module configuring the Active Objects service used by this plugin</description>
        <entity>com.mycomp.execspec.jiraplugin.ao.StoryAO</entity>
    </ao>

    <!-- ==================================================================================================== -->
    <!-- Custom components -->
    <!-- ==================================================================================================== -->
    <component key="story-dao" name="Story DAO" class="com.mycomp.execspec.jiraplugin.ao.StoryDaoImpl"/>
    <component key="story-service" name="Story Service"
               class="com.mycomp.execspec.jiraplugin.service.StoryServiceImpl"/>

</atlassian-plugin>
